<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Dashboard">
    <meta name="keyword" content="Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">

    <title>Admin | Manage Users</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">

    <link href="/assets/css/bootstrap.css" rel="stylesheet">
    <link href="/assets/css/jquery-ui.css" rel="stylesheet">
    <link href="/assets/font-awesome/css/font-awesome.css" rel="stylesheet" />
    <link href="/assets/css/style.css" rel="stylesheet">
    <link href="/assets/css/style-responsive.css" rel="stylesheet">
    <link href="/assets/css/sweetalert.css" rel="stylesheet">
    <link href="/assets/css/bootstrap-select.css" rel="stylesheet">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/themes/default/style.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/jszip-2.5.0/dt-1.10.18/b-1.5.6/b-flash-1.5.6/b-html5-1.5.6/b-print-1.5.6/datatables.min.css"/>
    <script type="text/javascript">
      function switchTo(page, el) {
        if (page != "summary") {
          $('#sm').show();
        } else {

        }
        $('#sml').show();
        $('#selectMethods').find("option").remove();
        try {
          $('#selectMethods').multiselect('destroy');
        } catch(e) {

        }
        if (page == "summary") {
          api.call("listTypes", function(res) {
            var slist = _.sortBy(res.records,"name");
            $.each(slist, function() {
              $("<option value='" + this.sale_type+ "'>" + this.name + "</option>").appendTo($("#selectMethods"));
            });
            $('#selectMethods').multiselect({
                includeSelectAllOption: true,
                enableFiltering: true,
                onChange: function(option, checked, select) {
                   setSession();
               },
               onSelectAll: function() {
                   setSession();
              },
              onDeselectAll: function() {
                 setSession();
               }
            });
          }, {}, {});
        }
        if (page == "revenue") {
          api.call("listMethods", function(res) {
            var slist = _.sortBy(res.records,"name");
            $.each(slist, function() {
              $("<option value='" + this.id + "'>" + this.name + "</option>").appendTo($("#selectMethods"));
            });
            $('#selectMethods').multiselect({
                includeSelectAllOption: true,
                enableFiltering: true,
                onChange: function(option, checked, select) {
                   setSession();
               },
               onSelectAll: function() {
                   setSession();
              },
              onDeselectAll: function() {
                 setSession();
               }
            });
          }, {}, {});
        }
        if (page == "fuel_value" || page == "fuel_volume" || page == "fuel_received") {
          api.call("listFuel", function(res) {
            var slist = _.sortBy(res.records,"name");
            $.each(slist, function() {
              $("<option value='" + this.id + "'>" + this.grade + "</option>").appendTo($("#selectMethods"));
            });
            $('#selectMethods').multiselect({
                includeSelectAllOption: true,
                enableFiltering: true,
                onChange: function(option, checked, select) {
                   setSession();
               },
               onSelectAll: function() {
                   setSession();
              },
              onDeselectAll: function() {
                 setSession();
               }
            });
          }, {}, {});

        }
        if (page == "oil_lottery") {

            $("<option value='1'>Oil</option>").appendTo($("#selectMethods"));
            $("<option value='2'>Lottery</option>").appendTo($("#selectMethods"));
            $('#selectMethods').multiselect({
                includeSelectAllOption: true,
                enableFiltering: true,
                onChange: function(option, checked, select) {
                   setSession();
               },
               onSelectAll: function() {
                   setSession();
              },
              onDeselectAll: function() {
                 setSession();
               }
            });
        }
        try {
          $('#selectMethods').multiselect('refresh');
        } catch(e) {

        }
        $('#selectMethods').multiselect('selectAll', false);
        $('#selectMethods').multiselect('updateButtonText');
        setSession();
        setTimeout(function() {
          $("#reportFrame").attr("src", "http://samygroups.co.uk/reports/generators/" + page + ".php");
          $("#nav-accordion").find("a").removeClass("active");
          $(el).addClass("active");
        }, 1500);

      }
    </script>
    <style>
      td {
        padding-left: 15px;
        padding-right: 15px;

      }
    </style>
  </head>

  <body>

  <section id="container" >
      <header class="header black-bg">
              <div class="sidebar-toggle-box">
                  <div class="fa fa-bars tooltips" data-placement="right" data-original-title="Toggle Navigation"></div>
              </div>
            <a href="#" class="logo"><b>REPORTS</b></a>
            <div class="nav notify-row" id="top_menu">
            </div>
            <div class="top-menu">
                  <li><a class="logout" onclick="delete localStorage.user;window.location.href = 'http://samygroups.co.uk';">Logout</a></li>
            	</ul>
            </div>
        </header>
      <aside>
          <div id="sidebar"  class="nav-collapse ">
              <ul class="sidebar-menu" id="nav-accordion">
            	   <h5 class="centered"></h5>
                    <li class="sub-menu">
                      <a href="#" onclick="switchTo('summary', this);" >
                          <i class="fa fa-users"></i>
                          <span><strong>Summaery<strong></span>
                      </a>
                      <a href="#" onclick="switchTo('revenue', this);" >
                          <i class="fa fa-users"></i>
                          <span>Payments</span>
                      </a>
                      <a href="#" onclick="switchTo('fuel_value', this);">
                          <i class="fa fa-users"></i>
                          <span>Fuel (value)</span>
                      </a>
                      <a href="#" onclick="switchTo('fuel_volume', this);">
                          <i class="fa fa-users"></i>
                          <span>Fuel (volume)</span>
                      </a>
                      <a href="#" onclick="switchTo('fuel_received', this);">
                          <i class="fa fa-users"></i>
                          <span>Fuel (received)</span>
                      </a>
                      <a href="#" onclick="switchTo('oil_lottery', this);">
                          <i class="fa fa-users"></i>
                          <span>Oil & lottery</span>
                      </a>
                    </li>
                </ul>
          </div>
      </aside>
      <section id="main-content">
          <section page class="wrapper" style="padding:0;">

              <div style="border-bottom: 1px solid black;width:100%;margin-top:0px;padding-top: 10px;text-align:center;">
                <table style="margin:0 auto;">
                  <tr>
                    <td>
                      <label for="from">From Date</label>
                      <input type="text" class="form-control" id="dateFrom" />
                    </td>
                    <td>
                      <label for="to">To Date</label>
                      <input type="text" class="form-control" id="dateTo" />
                    </td>
                    <td>
                      <label for="selectSites">Select sites</label><br />
                      <select id="selectSites" multiple="multiple" style="margin-top:10px;min-width:300px;">
                      </select>
                    </td>
                    <td>
                      <div id="sm">
                        <label id="sml"  for="selectMethods">Additional filter</label><br />
                        <select id="selectMethods" multiple="multiple" style="margin-top:10px;min-width:300px;">
                        </select>
                      </div>
                    </td>
                    <td>
                      <label for="selectSites">Grouping</label><br />
                      <select id="grouping" onchange="setSession();"  class="form-control" style="margin-top:0px;">
                        <option value="sum">Summary</option>
                        <option value="sites">By site</option>

                      </select>
                    </td>
                    <td>
                      <label for="selectSites">Timeline</label><br />
                      <select id="timeline" onchange="setSession();" class="form-control" style="margin-top:0px;">
                        <option value="sum">Summary</option>
                        <option value="day">By day</option>
                        <option value="week">By weeks</option>
                        <option value="month">By months</option>
                      </select>
                    </td>
                  </tr>
                </table>
                <iframe style="width:100%;height:200vh;margin-top:10px;overflow: auto;"  src="" id="reportFrame"></iframe>
            </div>
          </section>
        </section>
    </section>
    <script src="/assets/js/jquery.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>
    <script class="include" type="text/javascript" src="/assets/js/jquery.dcjqaccordion.2.7.js"></script>
    <script src="/assets/js/jquery.scrollTo.min.js"></script>
    <script src="/assets/js/jquery.nicescroll.js" type="text/javascript"></script>
    <script src="/assets/js/common-scripts.js"></script>
    <script type="text/javascript" src="/assets/js/api.js"></script>
    <script type="text/javascript" src="/assets/js/sweetalert2.js"></script>
    <script type="text/javascript" src="/assets/js/jquery.validate.js"></script>
    <script type="text/javascript" src="/assets/js/underscore.js"></script>
    <link rel="stylesheet" href="/assets/css/bootstrap-select.css" type="text/css"/>
    <script type="text/javascript" src="/assets/js/bootstrap-select.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/jstree.min.js"></script>
   <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
   <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
   <script type="text/javascript" src="https://cdn.datatables.net/v/dt/jszip-2.5.0/dt-1.10.18/b-1.5.6/b-flash-1.5.6/b-html5-1.5.6/b-print-1.5.6/datatables.min.js"></script>
   <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.6/js/buttons.colVis.min.js"></script>
   <script type="text/javascript">
    var sitelist = null;
    var fromDate = null;
    var toDate = null;
    $(document).ready(function() {
      api.call("listMethods", function(res) {
        var slist = _.sortBy(res.records,"name");
        $.each(slist, function() {
          $("<option value='" + this.id + "'>" + this.name + "</option>").appendTo($("#selectMethods"));
        });
        $('#selectMethods').multiselect({
            includeSelectAllOption: true,
            enableFiltering: true,
            onChange: function(option, checked, select) {
               setSession();
           },
           onSelectAll: function() {
               setSession();
          },
          onDeselectAll: function() {
             setSession();
           }
        });
      }, {}, {});

    $('#selectMethods').multiselect('selectAll', false);
    $('#selectMethods').multiselect('updateButtonText');
      api.call("listSites", function(res) {
        var slist = _.sortBy(res.records,"site");
        $.each(slist, function() {
          $("<option value='" + this.id + "'>" + this.site + "</option>").appendTo($("#selectSites"));
        });
        $('#selectSites').multiselect({
            includeSelectAllOption: true,
            enableFiltering: true,
            onChange: function(option, checked, select) {
               setSession();
           },
           onSelectAll: function() {
               setSession();
          },
          onDeselectAll: function() {
             setSession();
           }
        });
      }, {}, {});
      $('#dateFrom').datepicker({
        maxDate: "-1D",
        onSelect: function(dateText) {
          if ($('#dateFrom').datepicker('getDate') > $('#dateTo').datepicker('getDate')) {
            $('#dateTo').datepicker('setDate', $('#dateFrom').datepicker('getDate'));
          }
          var dt = $('#dateFrom').datepicker('getDate');
          fromDate = dt.getFullYear() + "-" + (dt.getMonth() + 1).toString().padStart(2, "0") + "-" + dt.getDate().toString().padStart(2, "0");
          setSession();
        }
      });
      $('#dateTo').datepicker({
        maxDate: "-1D",
        onSelect: function(dateText) {
          if ($('#dateFrom').datepicker('getDate') > $('#dateTo').datepicker('getDate')) {
            $('#dateTo').datepicker('setDate', $('#dateFrom').datepicker('getDate'));
          }
          var dt = $('#dateTo').datepicker('getDate');
          toDate = dt.getFullYear() + "-" + (dt.getMonth() + 1).toString().padStart(2, "0") + "-" + dt.getDate().toString().padStart(2, "0");
          setSession();
        }
      });
      $('#dateFrom').datepicker('setDate', 'yesterday');
      var dt = $('#dateFrom').datepicker('getDate');
      fromDate = dt.getFullYear() + "-" + (dt.getMonth() + 1).toString().padStart(2, "0") + "-" + dt.getDate().toString().padStart(2, "0");

      $('#dateTo').datepicker('setDate', 'yesterday');
      var dt = $('#dateTo').datepicker('getDate');
      toDate = dt.getFullYear() + "-" + (dt.getMonth() + 1).toString().padStart(2, "0") + "-" + dt.getDate().toString().padStart(2, "0");

      $('#selectSites').multiselect('selectAll', false);
      $('#selectSites').multiselect('updateButtonText');

      setTimeout(function() {
        setSession();
      }, 1500);
    });
    function setSession() {

      $.ajax({
        url: "/reports/ajax/setSession.php",
        type: "POST",
        data: {
          dateto: toDate,
          datefrom: fromDate,
          sites: $("#selectSites").val(),
          meth: $("#selectMethods").val(),
          grouping: $("#grouping").val(),
          timeline: $("#timeline").val()
        },
        success: function(res) {
          if ($("#reportFrame").attr("src") != "" && $("#selectSites").val() == null) {
            swal({
              type: "error",
              text: "At least one site must be selected"
            })
            return false;
          }
          if ($("#reportFrame").attr("src") != "" && $("#selectSites").val() != null) {
            $("#reportFrame").attr("src", $("#reportFrame").attr("src"));
          }
        }
      })
    }
   </script>

  </body>
</html>
